function display_list_element(a,b,c,d,e,f,g){return'<li id="message-'+a+'"><div class="picture"><img src="'+c+'" /></div><div class="details">'+'<div class="date"><p title="'+f+'">'+f+'</p></div><div class="name"><a href="'+d+'">'+b+"</a>"+'</div><div class="message"><p>'+e+"</p></div></div></li>"}$(document).ready(function(){function g(){$.ajax({url:"/chat/"+e+"/json/last",timeout:1e3,success:function(c){date=new Date(c[1]),date>a&&c[0]!=d&&(a=date,d=c[0],$.ajax({url:"/chat/"+e+"/json/"+c[0],timeout:1e3,success:function(a){$("ul.chat").append(display_list_element(b,a[1],a[2],a[3],a[4],a[5],a[6])),$("#message-"+b)[0].scrollIntoView(!0),b++}}))}})}function h(a){a.preventDefault(),$.post("",{message:$("#id_message").val(),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()}),$("#id_message").val("")}function i(){$.ajax({url:"/chat/"+e+"/json/last/seen",timeout:1e3,success:function(a){console.log(a[0])}})}function j(){$.get("/chat/"+e+"/json/seen")}$("#id_message").autosize();var a=new Date(0),b=1,c=!0,d=1,e=$("#partner_name").val(),f=new Array;$.ajax({url:"/chat/"+e+"/json",success:function(c){$.each(c,function(c,d){f.push(display_list_element(b,d[1],d[2],d[3],d[4],d[5],d[6])),b++,forCompare=new Date(d[5]),a<forCompare&&(a=forCompare)});for(var d=f.length;f.length-10<=d;d--)$("ul.chat").append(f[d]);$("#message-1")[0].scrollIntoView(!0),g()}}),$("#chat_submit").click(function(a){h(a)}),$("#id_message").keydown(function(a){a.keyCode==13&&a.shiftKey==0&&h(a)}),$(document).on("mousemove",function(){c&&(c=!1,g(),j(),i(),setTimeout(function(){c=!0},1e3))})});