function display_list_element(a,b,c,d,e,f,g){return'<li id="message-'+a+'"><div class="picture"><img src="'+c+'" /></div><div class="details">'+'<div class="date"><p title="'+f+'">'+f+'</p></div><div class="name"><a href="'+d+'">'+b+"</a>"+'</div><div class="message"><p>'+e+"</p></div></div></li>"}$(document).ready(function(){function h(){$.ajax({url:"/chat/"+e+"/json/last",timeout:1e3,success:function(c){date=new Date(c[1]),date>a&&c[0]!=d&&(a=date,d=c[0],$.ajax({url:"/chat/"+e+"/json/"+c[0],timeout:1e3,success:function(a){$("ul.chat").append(display_list_element(b,a[1],a[2],a[3],a[4],a[5],a[6])),$("#message-"+b)[0].scrollIntoView(!0),b++}}))}})}function i(a){a.preventDefault(),$.post("",{message:$("#id_message").val(),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()}),$("#id_message").val("")}function j(){$.ajax({url:"/chat/"+e+"/json/last/seen",success:function(a){f=new Date(a.date)}}),setTimeout(function(){f!=0&&$("li .date").each(function(a){current_date=new Date($(this).text()),current_date>f?$(this).parent().parent().addClass("not_seen"):$(this).parent().parent().removeClass("not_seen")})},200)}function k(){$.get("/chat/"+e+"/json/seen")}function l(){c&&(c=!1,h(),k(),setTimeout(function(){j()},200),setTimeout(function(){c=!0},1e3))}var a=new Date(0),b=1,c=!0,d=1,e=$("#partner_name").val(),f=!1,g=new Array;$.ajax({url:"/chat/"+e+"/json",success:function(c){$.each(c,function(c,d){g.push(display_list_element(b,d[1],d[2],d[3],d[4],d[5],d[6])),b++,forCompare=new Date(d[5]),a<forCompare&&(a=forCompare)});for(var d=g.length;g.length-10<=d;d--)$("ul.chat").append(g[d]);$("#message-1")[0].scrollIntoView(!0),setInterval(function(){l()},1e3)}}),$("#chat_submit").click(function(a){i(a),setTimeout(l(),100)}),$("#id_message").keydown(function(a){a.keyCode==13&&a.shiftKey==0&&(i(a),setTimeout(l(),100))}),$(document).on("mousemove",function(){l()})});