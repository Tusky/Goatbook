function refreshComments(a){var b="/wallpost/"+a+"/comments/",c="";$.ajax({url:b,success:function(b){for(var d=0;d<b.comments.length;d++)c+=createComment(b.comments[d][0],b.comments[d][1],b.comments[d][2],b.comments[d][3],b.comments[d][4],b.comments[d][5]);$(".comments."+a).children(".comment").remove(),$(".comments."+a).prepend(c),$(".timeago").timeago()}});return}function doStuff(a,b,c){var d=b.split(","),e=c.split(","),f="",g="",h=0,i=0,j="",k="";$.each(d,function(a){a<3?a+1==d.length||a+1==3?g+=d[a]:g+=d[a]+", ":(h++,a+1==d.length?j+=d[a]:j+=d[a]+", ")}),$.each(e,function(a){a<3?a+1==e.length||a+1==3?f+=e[a]:f+=e[a]+", ":(i++,a+1==hate.length?k+=e[a]:k+=e[a]+", ")}),j.length!=0&&(g=g+' and <abbr title="'+j+'">'+h+" more</abbr>"),k.length!=0&&(f=f+' and <abbr title="'+k+'">'+i+" more</abbr>"),a.parents(".post").find(".opinion .like span").text(g),a.parents(".post").find(".opinion .dislike span").text(f),b.length==0?a.parents(".post").find(".opinion .like").hide():a.parents(".post").find(".opinion .like").show(),c.length==0?a.parents(".post").find(".opinion .dislike").hide():a.parents(".post").find(".opinion .dislike").show()}function createComment(a,b,c,d,e,f){var g=new Date(f),e='<div class="comment '+a+'">'+'<div class="content">'+e+"</div>"+'<div class="commenter"><a href="'+d+'">'+c+"</a></div>"+'<div class="date"><abbr class="timeago" title="'+g.toISOString()+'">'+f+"</abbr></div>";return b==="True"&&(e+='<div class="options"><span class="delete" data-commentid="'+a+'">Delete</span>'+"</div>"),e+="</div>",e}$().ready(function(){$(".timeago").timeago(),$("#id_wallpost").autosize(),$(".commentbox").autosize(),$(".opinion .dislike span").each(function(){$(this).text().trim().length==0&&$(this).parents(".dislike").hide()}),$(".opinion .like span").each(function(){$(this).text().trim().length==0&&$(this).parents(".like").hide()}),$(".options .like span").click(function(){var a=$(this),b=$(this).parents().siblings(".date").children("a").attr("href")+"/like";$.ajax({url:b,success:function(b){switch(b.response){case"removed":a.text("Like"),doStuff(a,b.liked_by,b.hated_by);break;case"liked":a.text("Liked"),a.parents(".options").children(".dislike").children("span").text("Dislike"),doStuff(a,b.liked_by,b.hated_by);break;default:console.log("error")}}})}),$(".options .dislike span").click(function(){var a=$(this),b=$(this).parents().siblings(".date").children("a").attr("href")+"/dislike";$.ajax({url:b,success:function(b){switch(b.response){case"removed":a.text("Dislike"),doStuff(a,b.liked_by,b.hated_by);break;case"disliked":a.text("Disliked"),a.parents(".options").children(".like").children("span").text("Like"),doStuff(a,b.liked_by,b.hated_by);break;default:console.log("error")}}})}),$(".options .comments span").live("click",function(){$(this).parents(".post").children(".comments").slideToggle()}),$(".delete").live("click",function(){console.log("clickedy click");var a=$(this),b=$(this).data("commentid");$.ajax({url:"/wallpost/deleteComment/"+b,success:function(b){b.response&&a.parents(".comment").remove()}})}),$(".post_comment").live("click",function(a){a.preventDefault();var b=$(this),c=$(this).parents("form").attr("action"),d=$(this).siblings("textarea").val(),e=$(this).siblings("div").children("input[name=csrfmiddlewaretoken]").val();d.length>0&&($.post(c,{wallcomment:d,csrfmiddlewaretoken:e}),$(this).siblings("textarea").val("")),setTimeout(function(){refreshComments(b.parents(".comments").attr("class").split(" ")[1])},300)}),$("#wallpost_send").click(function(a){a.preventDefault();var b="/wallpost/addPost",c=$("#id_wallpost").val(),d=$(this).siblings("div").children("input[name=csrfmiddlewaretoken]").val();$.post(b,{wallpost:c,csrfmiddlewaretoken:d}),location.reload()})});